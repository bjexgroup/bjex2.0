<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>注册</title>
    <link rel="stylesheet" href="./css/base.css">
    <link rel="stylesheet/less" type="text/css" href="./css/details.less" />
    <script type="text/javascript" src="./libs/less/less.min.js"></script>
    <style>
        body {
            background: #fff;
        }
    </style>
</head>

<body>
    <!-- 头部 -->
    <header class="navbar">
        
        <div class="toolBar container">
            <div class="logo">
                <a>
                    <img src="./imgs/logo1.png" alt="">
                </a>
            </div>
            <div class="top_list">
                <ul>
                    <li><a href="">交易中心</a></li>
                    <li><a href="">c2c交易</a></li>
                    <li><a href="">区块商城</a><img src="./imgs/down.png"></li>
                    <li><a href="">消息中心</a><img src="./imgs/down.png"></li>
                    <li><a href="">帮助中心</a><img src="./imgs/down.png"></li>
                </ul>

            </div>
            <div class="login">
                <ul>
                    <li><a href="login.html">登录</a></li>
                    <li><a href="registration.html">注册</a></li>
                    
                    <li class="national-mouse">
                        <a class="china" href=""><img src="./imgs/china.png" alt=""></a>

                        <div class="national">
                            <a class="china" href="javascript:;"><img src="./imgs/china.png" alt=""></a>
                            <a class="china" href="javascript:;"><img src="./imgs/china.png" alt=""></a>
                            <a class="china" href="javascript:;"><img src="./imgs/china.png" alt=""></a>
                        </div>
                    </li>
                    <li class="">
                        <a href=""><img class="up-down" src="./imgs/down.png" alt=""></a>

                    </li>
                </ul>

            </div>
            <div class="personal_center">
                <div class="info_img">
                        <img src="./imgs/personalname.png" alt="">
                </div>
                
                <div class="accont_numb">
                    <div class="text">
                            <a href="">182****3452</a>
                    </div>
                     
                    <div class="personal_list">
                            <ul>
                                <li><a href="">个人中心</a></li>
                                <li><a href="">财务中心</a></li>
                                <li><a href="">安全中心</a></li>
                                <li><a href="">推荐好友</a></li>
                            </ul>
                    </div>
                </div>
                
            </div>
        </div>
    </header>
    <!-- 注册 -->
    <section class="form">
        <div class="registration">
            <div class="control number">
                <input placeholder="电子邮件/手机号" type="text" id="account">
            </div>
            <div class="control password">
                <input placeholder="请设置6-16位数字或字母的登陆密码" type="password" id="password">
                <i class="secret"></i>
            </div>
            <div class="control password">
                <input placeholder="确认密码" type="password" id="confirm">

            </div>
            <div class="control">
                <input placeholder="请输入邀请码（非必填）" type="text" id="invitation">
            </div>
            <div class="control code">
                <input placeholder="图形验证码" type="text" id="verificationImg">
                <img id="getVerificationImg" title="点击更换验证码">
            </div>
            <div class="control code verification">
                <input placeholder="手机验证码" type="text" id="verificationText">
                <!-- <span id="getVerificationText">获取短信验证码</span> -->
                <input value="获取短信验证码" id="getVerificationText" class="getVerificationText" type="button">
            </div>
            <button id="Create"><a>创建账户</a></button>
            <div class="bar">
                注册即视为同意<a href="protocol.html">用户注册协议</a>
                <a class="forget" href="login.html">是否已经有一个账户？</a>
            </div>
        </div>
    </section>
    <script src="./libs/jquery/jquery.min.js"></script>
    <script src="./libs/layer/layer.js"></script>
    <script src="./libs/common/common.js"></script>
    <script>
        var countdown = 3; //倒计时
        $("#getVerificationImg").click(function() {
            let num = Math.random()
            $(this).attr("src", baseLink + "/user/imageCode.action?d=" + num)
        })

        $("#getVerificationText").click(function() {
            getCode()
        })





        function getCode() {
            var account = $('#account').val(); //账号
            var verificationImg = $('#verificationImg').val(); //图片
            var reg = /^1[3|4|5|6|7|8|9][0-9]\d{4,8}$/; //定义手机号正则表达式
            var regEmail = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;

            console.log(verificationImg);
            if (account == '') {
                layer.tips('请输入账号', '#account', {
                    tips: 3
                });
                return
            }
            if (!(reg.test(account)) && !(regEmail.test(account))) {
                layer.tips('账号格式不正确1', '#account', {
                    tips: 3
                });
                return false;
            }
            // if (!(regEmail.test(account))) {
            //     layer.tips('账号格式不正确2', '#account', {
            //         tips: 3
            //     });
            //     return false;
            // }

            if (verificationImg == '') {
                layer.tips('请输入图片验证码', '#verificationImg', {
                    tips: 3
                });
                return
            }
            var param = {
                phone: account,
                type: 1, //1:注册,2:找回密码
                imageCodes: verificationImg //图片验证码
            }
            console.log(param)
            $.ajax({
                type: "POST",
                url: baseLink + "/user/getCode.action",
                dataType: 'JSON', //JSON
                data: param,
                success: function(data) {
                    console.log(data)
                    if (data.retcode == 10001) {
                        layer.msg(data.msg);
                        let num = Math.random()
                        $("#getVerificationImg").attr("src", baseLink + "/user/imageCode.action?d=" + num)
                        $("#verificationImg").val("");
                    } else {
                        layer.msg(data.msg);
                        settime($("#getVerificationText"));
                    }
                }
            });
        }

        function settime(obj) {
            if (countdown == 0) {
                // $(this).removeClass("disabled");
                obj.attr('disabled', false);
                obj.removeClass("disabled");
                obj.val("免费获取验证码");
                countdown = 3;
                return;
            } else {
                obj.attr('disabled', true);
                obj.addClass("disabled");
                obj.val("重新发送(" + countdown + ")");
                countdown--;
            }
            setTimeout(function() {
                settime(obj)
            }, 1000)
        };
        $(".secret").click(function() { //密码展示隐藏
            $(this).toggleClass("active");
            var typeOf = $(this).siblings("input").attr("type")
            if (typeOf == "text") {
                $(this).siblings("input").attr("type", "password");
            } else {
                $(this).siblings("input").attr("type", "text");
            }
        });
        $("#Create").click(function() { //注册
            var account = $('#account').val(); //账号
            var password = $('#password').val(); //密码
            var confirm = $('#confirm').val(); //确认
            var userCode = $('#userCode').val(); //邀请码
            var verificationImg = $('#verificationImg').val(); //图片
            var verificationText = $('#verificationText').val(); //短信
            if (account == '') {
                layer.tips('请输入账号', '#account', {
                    tips: 3
                });
                return
            }
            if (password == '') {
                layer.tips('请输入密码', '#password', {
                    tips: 3
                });
                return
            } else if (password.length < 6 || password.length > 16) {
                layer.tips('密码长度只允许6-16位~', '#password', {
                    tips: 3
                });
            }

            if (confirm == '') {
                layer.tips('请确认密码', '#password', {
                    tips: 3
                });
                return
            } else if (confirm != password) {
                layer.tips('两次输入密码不一致', '#confirm', {
                    tips: 3
                });
                return
            }
            if (verificationImg == '') {
                layer.tips('请输入图片验证码', '#verificationImg', {
                    tips: 3
                });
                return
            }
            // if (verification == '') {
            //     layer.msg('图片验证码错误，请重新输入');
            //     return
            // }
            if (verificationText == '') {
                layer.tips('请输入短信验证码', '#verificationText', {
                    tips: 3
                });
                return
            }
            if (userCode == undefined) {
                userCode = '';
            }
            // if (verificationText == '') {
            //     layer.msg('短信验证码错误，请重新输入');
            //     return
            // }
            var param = {
                user_tel: account,
                password: password,
                userCode: userCode, //邀请码
                code: verificationText //短信验证码
            }
            $.ajax({
                type: "POST",
                url: baseLink + "/user/register.action",
                dataType: 'JSON',
                data: param,
                success: function(data) {
                    console.log(data)
                    if (data.retcode == 10000) {
                        layer.msg(data.msg + "即将跳转登录页", {
                            time: 3000
                        });
                        emil = data.emil;
                        user_id = data.user_id;
                        mycode = data.mycode;
                        user_tel = data.user_tel;
                        setTimeout(function() {
                            window.location.href = 'login.html'
                        }, 3000)
                    } else {
                        layer.msg(data.msg);

                    }
                }
            });
        })
        $(function() {
            //图片验证码 
            $("#getVerificationImg").attr("src", baseLink + "/user/imageCode.action")
        })
    </script>
</body>

</html>